<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å•†æ’ä¸»æœåŠ¡å™¨ - æ‰‹æœºç«–å±ç›‘æ§é¢æ¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif; }
        :root {
            --primary: #165DFF;
            --success: #00B42A;
            --warning: #FF7D00;
            --danger: #F53F3F;
            --info: #86909C;
            --dark: #1D2129;
            --light: #FFFFFF;
            --bg: #F7F8FA;
            --card-bg: #FFFFFF;
            --border: #E5E6EB;
            --shadow: 0 2px 12px rgba(0,0,0,0.08);
            --attack-shadow: 0 0 15px rgba(245, 63, 63, 0.3);
        }
        body { 
            background-color: var(--bg); 
            color: var(--dark); 
            padding: 15px; 
            transition: all 0.3s ease;
            overflow-x: hidden;
            position: relative; /* ä¸ºæ”»å‡»å¼¹çª—åšçˆ¶å®¹å™¨å®šä½ */
        }
        .container { max-width: 100%; margin: 0 auto; }
        /* å¤´éƒ¨ä¼˜åŒ– */
        .header { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .header-title h1 { font-size: 22px; color: var(--primary); margin: 0; display: flex; align-items: center; gap: 8px; }
        .header-title .server-tag { background-color: var(--primary); color: white; padding: 2px 8px; border-radius: 15px; font-size: 12px; font-weight: 500; margin-left: 8px; }
        .current-time { font-size: 14px; color: var(--info); display: flex; align-items: center; gap: 6px; margin-top: 5px; }
        .refresh-btn { background-color: var(--primary); color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background-color 0.2s; }
        .refresh-btn:hover { background-color: #0E4BDB; }

        /* ç½‘æ ¼å¸ƒå±€ï¼ˆæ‰‹æœºç«–å±ä¼˜åŒ–ï¼‰ */
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .card { 
            background-color: var(--card-bg); 
            border-radius: 10px; 
            padding: 18px; 
            box-shadow: var(--shadow); 
            transition: all 0.3s ease; 
            border: 1px solid var(--border);
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .card.under-attack { border-color: var(--danger); box-shadow: var(--attack-shadow); animation: attackPulse 1s infinite alternate; }
        @keyframes attackPulse { from { box-shadow: var(--attack-shadow); } to { box-shadow: 0 0 20px rgba(245, 63, 63, 0.5); } }
        /* é€šæ å¡ç‰‡ */
        .card.full-width { grid-column: span 2; }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .card-header h3 { font-size: 15px; color: var(--dark); margin: 0; display: flex; align-items: center; gap: 6px; }
        .card-header h3 i { font-size: 16px; color: var(--primary); }
        .card-status { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .status-normal { background-color: rgba(0, 180, 42, 0.1); color: var(--success); }
        .status-warning { background-color: rgba(255, 125, 0, 0.1); color: var(--warning); }
        .status-danger { background-color: rgba(245, 63, 63, 0.1); color: var(--danger); }
        .status-info { background-color: rgba(134, 144, 156, 0.1); color: var(--info); }

        .card-body { margin-bottom: 15px; }
        .data-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .data-label { font-size: 13px; color: var(--info); }
        .data-value { font-size: 16px; font-weight: 600; color: var(--dark); }
        .data-value.large { font-size: 18px; }
        .data-value.success { color: var(--success); }
        .data-value.warning { color: var(--warning); }
        .data-value.danger { color: var(--danger); }
        .data-value.primary { color: var(--primary); }

        /* è¿›åº¦æ¡ä¼˜åŒ– */
        .progress-container { width: 100%; height: 6px; background-color: #F2F3F5; border-radius: 3px; margin-top: 6px; }
        .progress-bar { height: 100%; border-radius: 3px; transition: width 0.5s ease; }
        .progress-success { background-color: var(--success); }
        .progress-warning { background-color: var(--warning); }
        .progress-danger { background-color: var(--danger); }

        /* é˜²ç«å¢™åŒºåŸŸä¼˜åŒ– */
        .attack-log { max-height: 120px; overflow-y: auto; padding: 10px; background-color: #FCFCFD; border-radius: 6px; margin-top: 12px; border: 1px solid var(--border); }
        .log-item { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
        .log-item:last-child { border-bottom: none; }
        .log-type { font-weight: 500; width: 100%; margin-bottom: 2px; }
        .log-type.attack { color: var(--danger); }
        .log-type.defend { color: var(--success); }
        .log-content { flex: 1; }
        .log-time { color: var(--info); font-size: 11px; }
        .defend-btn { 
            background-color: var(--success); 
            color: white; 
            border: none; 
            border-radius: 6px; 
            padding: 10px 0; 
            font-size: 15px; 
            font-weight: 600; 
            cursor: pointer; 
            margin-top: 12px; 
            transition: background-color 0.2s; 
            display: none;
            width: 100%;
        }
        .defend-btn.show { display: block; }
        .defend-btn:hover { background-color: #009A22; }
        /* é˜²å¾¡ä¸­æŒ‰é’®æ ·å¼ */
        .defend-btn.defending {
            background-color: #009A22;
            animation: defendPulse 0.8s infinite alternate;
        }
        @keyframes defendPulse {
            from { opacity: 0.9; transform: scale(1); }
            to { opacity: 1; transform: scale(1.02); }
        }

        /* åº•éƒ¨ä¿¡æ¯ */
        .footer { text-align: center; padding: 15px 0; color: var(--info); font-size: 12px; border-top: 1px solid var(--border); margin-top: 20px; }
        .footer-links { display: flex; justify-content: center; gap: 15px; margin-top: 8px; }
        .footer-links a { color: var(--primary); text-decoration: none; font-size: 11px; }
        .footer-links a:hover { text-decoration: underline; }

        /* æ”»å‡»å¼¹çª—ï¼ˆæœ€é«˜å±‚+ç™½è‰²èƒŒæ™¯ï¼‰ */
        .attack-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--light); /* ç™½è‰²èƒŒæ™¯ */
            z-index: 9999; /* æœ€é«˜å±‚çº§ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            color: var(--dark); /* é»‘è‰²æ–‡å­— */
            animation: popupFadeIn 0.5s ease;
            display: none; /* é»˜è®¤éšè— */
            text-align: center;
        }
        @keyframes popupFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .attack-popup.show { display: flex; }
        .popup-icon { font-size: 60px; color: var(--danger); margin-bottom: 20px; animation: pulse 1.5s infinite alternate; }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }
        .popup-title { font-size: 28px; font-weight: 700; margin-bottom: 15px; color: var(--danger); }
        .popup-desc { font-size: 18px; margin-bottom: 12px; line-height: 1.6; }
        .popup-ip { color: var(--primary); font-weight: 600; }
        /* å¼¹çª—é˜²å¾¡æŒ‰é’® */
        .popup-defend-btn {
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 16px 45px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }
        .popup-defend-btn:hover { background-color: #009A22; }
        /* å¼¹çª—é˜²å¾¡ä¸­çŠ¶æ€ */
        .popup-defend-btn.defending {
            background-color: #009A22;
            animation: defendPulse 0.8s infinite alternate;
            pointer-events: none; /* é˜²å¾¡ä¸­ç¦æ­¢é‡å¤ç‚¹å‡» */
        }
        /* é˜²å¾¡è¿›åº¦ä¸å€’è®¡æ—¶å®¹å™¨ */
        .defend-progress-container {
            width: 100%;
            margin-top: 25px;
        }
        /* é˜²å¾¡è¿›åº¦æ¡ */
        .defend-progress {
            width: 100%;
            height: 10px;
            background-color: #F2F3F5;
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
            display: none;
        }
        .defend-progress.show {
            display: block;
        }
        .defend-progress-bar {
            height: 100%;
            background-color: var(--success);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s linear;
        }
        /* é˜²å¾¡å€’è®¡æ—¶æ–‡å­— */
        .defend-countdown {
            font-size: 17px;
            font-weight: 600;
            color: var(--warning);
            display: none;
        }
        .defend-countdown.show {
            display: block;
        }
        /* æ”»å‡»å‰©ä½™æ—¶é—´æç¤ºï¼ˆæœªé˜²å¾¡æ—¶ï¼‰ */
        .attack-remaining-time {
            font-size: 17px;
            font-weight: 600;
            color: var(--danger);
            margin-top: 20px;
        }
        /* é˜²å¾¡æˆåŠŸæç¤º */
        .defend-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 180, 42, 0.95);
            color: white;
            padding: 25px 50px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: 700;
            z-index: 10000; /* é«˜äºæ”»å‡»å¼¹çª— */
            animation: successPop 0.5s ease, successFadeOut 1s ease 1.2s forwards;
            display: none;
        }
        @keyframes successPop {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        @keyframes successFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .defend-success.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <h1>ğŸ¢ å•†æ’ä¸»æœåŠ¡å™¨</h1>
                    <span class="server-tag">æ ¸å¿ƒç¯å¢ƒ</span>
                </div>
                <button class="refresh-btn" id="manualRefresh">
                    <i>ğŸ”„</i> åˆ·æ–°
                </button>
            </div>
            <div class="current-time">
                <i>ğŸ“…</i>
                <span id="currentDateTime">2025-01-01 00:00:00</span>
            </div>
        </div>

        <!-- æ ¸å¿ƒç›‘æ§ç½‘æ ¼ -->
        <div class="grid-layout">
            <!-- æœåŠ¡å™¨çŠ¶æ€ï¼ˆé€šæ ï¼‰ -->
            <div class="card full-width">
                <div class="card-header">
                    <h3><i>ğŸ–¥ï¸</i> æœåŠ¡å™¨çŠ¶æ€</h3>
                    <span class="card-status status-normal" id="serverOverallStatus">è¿è¡Œæ­£å¸¸</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-label">è¿è¡Œæ—¶é•¿</span>
                        <span class="data-value large success" id="serverUptime">0 å¤© 0 æ—¶ 0 åˆ† 0 ç§’</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">å¯åŠ¨æ—¶é—´</span>
                        <span class="data-value" id="serverStartTime">2025-01-15 08:30:00</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ç³»ç»Ÿç‰ˆæœ¬</span>
                        <span class="data-value">Ubuntu 22.04 LTS 64ä½</span>
                    </div>
                </div>
            </div>

            <!-- å…¬ç½‘IP -->
            <div class="card">
                <div class="card-header">
                    <h3><i>ğŸŒ</i> å…¬ç½‘IP</h3>
                    <span class="card-status status-normal">å·²è¿æ¥</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-value primary" id="publicIp">123.45.67.89</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">å†…ç½‘IP</span>
                        <span class="data-value">192.168.0.100</span>
                    </div>
                </div>
            </div>

            <!-- ç¡¬ä»¶é…ç½® -->
            <div class="card">
                <div class="card-header">
                    <h3><i>âš™ï¸</i> ç¡¬ä»¶é…ç½®</h3>
                    <span class="card-status status-normal">é…ç½®æ­£å¸¸</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-label">CPU</span>
                        <span class="data-value">8æ ¸ 3.4GHz</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">å†…å­˜</span>
                        <span class="data-value">32GB DDR4</span>
                    </div>
                </div>
            </div>

            <!-- èµ„æºä½¿ç”¨ç‡ -->
            <div class="card">
                <div class="card-header">
                    <h3><i>ğŸ“Š</i> èµ„æºä½¿ç”¨ç‡</h3>
                    <span class="card-status status-normal" id="resourceStatus">è´Ÿè½½æ­£å¸¸</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-label">CPU</span>
                        <span class="data-value warning" id="cpuUsage">28%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar progress-warning" id="cpuProgress" style="width: 28%"></div>
                    </div>
                    <div class="data-item" style="margin-top: 12px;">
                        <span class="data-label">å†…å­˜</span>
                        <span class="data-value" id="memUsage">45%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="memProgress" style="width: 45%"></div>
                    </div>
                </div>
            </div>

            <!-- ç«¯å£çŠ¶æ€ -->
            <div class="card">
                <div class="card-header">
                    <h3><i>ğŸšª</i> å¼€æ”¾ç«¯å£</h3>
                    <span class="card-status status-normal">å·²æ”¾è¡Œ</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-value">80(HTTP) 443(HTTPS)</span>
                    </div>
                    <div class="data-item">
                        <span class="data-value">22(SSH) 3306(MySQL)</span>
                    </div>
                </div>
            </div>

            <!-- å¹¶å‘è¿æ¥ -->
            <div class="card">
                <div class="card-header">
                    <h3><i>ğŸ‘¥</i> è¿æ¥çŠ¶æ€</h3>
                    <span class="card-status status-normal" id="connectionStatus">è¿æ¥ç¨³å®š</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-label">å½“å‰å¹¶å‘</span>
                        <span class="data-value large primary" id="currentConnections">248</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">å¼‚å¸¸è¿æ¥</span>
                        <span class="data-value" id="abnormalConnections">0</span>
                    </div>
                </div>
            </div>

            <!-- é˜²ç«å¢™ä¸æ”»å‡»é˜²å¾¡ï¼ˆé€šæ ï¼‰ -->
            <div class="card full-width" id="firewallCard">
                <div class="card-header">
                    <h3><i>ğŸ›¡ï¸</i> é˜²ç«å¢™ & æ”»å‡»é˜²å¾¡</h3>
                    <span class="card-status status-normal" id="firewallStatus">é˜²æŠ¤å¼€å¯</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-label">ä»Šæ—¥æ‹¦æˆªæ¬¡æ•°</span>
                        <span class="data-value danger" id="todayBlockCount">256</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">å½“å‰æ”»å‡»çŠ¶æ€</span>
                        <span class="data-value" id="currentAttackStatus">æ— æ”»å‡»é£é™©</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">æœ€è¿‘æ”»å‡»IP</span>
                        <span class="data-value danger" id="latestAttackIp">æ— </span>
                    </div>

                    <div class="attack-log" id="attackLogContainer">
                        <div class="log-item">
                            <span class="log-type">ç³»ç»Ÿæ—¥å¿—</span>
                            <span class="log-content">é˜²ç«å¢™é˜²æŠ¤å·²å¯åŠ¨ï¼Œæ— å¼‚å¸¸æ”»å‡»</span>
                            <span class="log-time" id="initialLogTime">åˆšåˆš</span>
                        </div>
                    </div>

                    <button class="defend-btn" id="defendButton">
                        ğŸ›¡ï¸ ç«‹å³æ‰§è¡Œé˜²å¾¡æªæ–½
                    </button>
                </div>
            </div>

            <!-- å­˜å‚¨ä¸å¸¦å®½ï¼ˆé€šæ ï¼‰ -->
            <div class="card full-width">
                <div class="card-header">
                    <h3><i>ğŸ’¾</i> å­˜å‚¨ & å¸¦å®½</h3>
                    <span class="card-status status-normal">æ­£å¸¸</span>
                </div>
                <div class="card-body">
                    <div class="data-item">
                        <span class="data-label">ç£ç›˜ä½¿ç”¨ç‡</span>
                        <span class="data-value" id="diskUsage">32%</span>
                        <span class="data-label" style="margin-left: 20px;">å­˜å‚¨ç±»å‹</span>
                        <span class="data-value">1TB NVMe SSD</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="diskProgress" style="width: 32%"></div>
                    </div>
                    <div class="data-item" style="margin-top: 12px;">
                        <span class="data-label">å¸¦å®½ä½¿ç”¨ç‡</span>
                        <span class="data-value" id="bandwidthUsage">22Mbps</span>
                        <span class="data-label" style="margin-left: 20px;">å¸¦å®½è§„æ ¼</span>
                        <span class="data-value">100Mbps ç‹¬äº«</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <div class="footer">
            <p>å•†æ’ä¸»æœåŠ¡å™¨ç›‘æ§ v2.0 | æ•°æ®æ¯2ç§’åˆ·æ–° | æ”»å‡»æ¯30ç§’è§¦å‘</p>
            <div class="footer-links">
                <a href="javascript:;" id="showHelp">ä½¿ç”¨å¸®åŠ©</a>
                <a href="javascript:;" id="exportLog">å¯¼å‡ºæ—¥å¿—</a>
            </div>
        </div>
    </div>

    <!-- æ”»å‡»å¼¹çª—ï¼ˆæœ€é«˜å±‚+ç™½è‰²èƒŒæ™¯ï¼‰ -->
    <div class="attack-popup" id="attackPopup">
        <div class="popup-icon">âš ï¸</div>
        <h2 class="popup-title">å•†æ’ä¸»æœåŠ¡å™¨é­å—æ”»å‡»ï¼</h2>
        <p class="popup-desc">æ”»å‡»ç±»å‹ï¼š<span id="popupAttackType">SSHæš´åŠ›ç ´è§£æ”»å‡»</span></p>
        <p class="popup-desc">æ”»å‡»IPï¼š<span class="popup-ip" id="popupAttackIp">218.18.19.25</span></p>
        <p class="popup-desc">è¯·ç«‹å³æ‰§è¡Œé˜²å¾¡ï¼Œå¦åˆ™ç³»ç»Ÿå°†åœ¨ <span id="attackRemainingSeconds">15</span> ç§’åè‡ªåŠ¨é˜²å¾¡ï¼</p>
        <div class="attack-remaining-time">å‰©ä½™æ—¶é—´ï¼š<span id="attackCountdown">15</span> ç§’</div>
        
        <div class="defend-progress-container">
            <div class="defend-progress" id="popupDefendProgress">
                <div class="defend-progress-bar" id="popupDefendProgressBar"></div>
            </div>
            <div class="defend-countdown" id="defendCountdownText">é˜²å¾¡å‰©ä½™æ—¶é—´ï¼š<span id="defendCountdown">3</span> ç§’</div>
        </div>
        
        <button class="popup-defend-btn" id="popupDefendButton">ğŸ›¡ï¸ ç«‹å³é˜²å¾¡</button>
    </div>

    <!-- é˜²å¾¡æˆåŠŸæç¤º -->
    <div class="defend-success" id="defendSuccessTip">
        ğŸ‰ é˜²å¾¡æˆåŠŸï¼å•†æ’ä¸»æœåŠ¡å™¨æ¢å¤æ­£å¸¸
    </div>

    <script>
        // æ ¸å¿ƒé…ç½®
        const SERVER_START_TIME = new Date(2025, 0, 15, 8, 30, 0);
        const ATTACK_INTERVAL = 30000; // æ”»å‡»é—´éš”30ç§’
        const ATTACK_DURATION = 15000; // æ”»å‡»æŒç»­15ç§’
        const DEFEND_DURATION = 3000; // é˜²å¾¡æŒç»­3ç§’
        const ATTACK_IP_POOL = [
            '218.18.19.25', '192.168.10.89', '103.207.32.145', '45.128.196.73',
            '175.178.201.36', '89.234.15.67', '203.98.12.45', '124.70.18.92'
        ];
        const ATTACK_TYPE_POOL = [
            'SSHæš´åŠ›ç ´è§£æ”»å‡»', 'SQLæ³¨å…¥æ”»å‡»', 'ç«¯å£æ‰«ææ”»å‡»', 'DDoSæµé‡æ”»å‡»',
            'XSSè·¨ç«™è„šæœ¬æ”»å‡»', 'ARPæ¬ºéª—æ”»å‡»', 'ICMPæ´ªæ°´æ”»å‡»', 'æ¶æ„æ–‡ä»¶ä¸Šä¼ æ”»å‡»'
        ];
        let isUnderAttack = false;
        let attackCount = 0;
        let defendCount = 0;
        let attackTimer = null; // æ”»å‡»æŒç»­è®¡æ—¶å™¨
        let defendProgressTimer = null; // é˜²å¾¡è¿›åº¦è®¡æ—¶å™¨
        let attackCountdownTimer = null; // æ”»å‡»å€’è®¡æ—¶è®¡æ—¶å™¨
        let defendCountdownTimer = null; // é˜²å¾¡å€’è®¡æ—¶è®¡æ—¶å™¨

        // è·å–DOMå…ƒç´ 
        const attackPopup = document.getElementById('attackPopup');
        const popupAttackType = document.getElementById('popupAttackType');
        const popupAttackIp = document.getElementById('popupAttackIp');
        const popupDefendButton = document.getElementById('popupDefendButton');
        const popupDefendProgress = document.getElementById('popupDefendProgress');
        const popupDefendProgressBar = document.getElementById('popupDefendProgressBar');
        const defendCountdownText = document.getElementById('defendCountdownText');
        const defendCountdown = document.getElementById('defendCountdown');
        const attackRemainingSeconds = document.getElementById('attackRemainingSeconds');
        const attackCountdown = document.getElementById('attackCountdown');
        const defendSuccessTip = document.getElementById('defendSuccessTip');
        const panelDefendButton = document.getElementById('defendButton');

        // æ›´æ–°å½“å‰æ—¶é—´ï¼ˆä¿æŒä¸å˜ï¼‰
        function updateCurrentDateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
            document.getElementById('currentDateTime').textContent = timeStr;
            return now;
        }

        // è®¡ç®—æœåŠ¡å™¨è¿è¡Œæ—¶é—´ï¼ˆä¿æŒä¸å˜ï¼‰
        function calculateServerUptime() {
            const now = new Date();
            const diffMs = now - SERVER_START_TIME;
            const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);
            return `${days} å¤© ${hours} æ—¶ ${minutes} åˆ† ${seconds} ç§’`;
        }

        // æ¨¡æ‹ŸåŠ¨æ€èµ„æºä½¿ç”¨ç‡ï¼ˆä¿æŒä¸å˜ï¼‰
        function simulateResourceUsage() {
            const cpu = Math.floor(Math.random() * 30) + 15;
            document.getElementById('cpuUsage').textContent = `${cpu}%`;
            document.getElementById('cpuProgress').style.width = `${cpu}%`;
            document.getElementById('cpuProgress').className = `progress-bar ${cpu > 40 ? 'progress-danger' : cpu > 30 ? 'progress-warning' : 'progress-success'}`;

            const mem = Math.floor(Math.random() * 20) + 35;
            document.getElementById('memUsage').textContent = `${mem}%`;
            document.getElementById('memProgress').style.width = `${mem}%`;

            const disk = Math.floor(Math.random() * 5) + 30;
            document.getElementById('diskUsage').textContent = `${disk}%`;
            document.getElementById('diskProgress').style.width = `${disk}%`;

            const bandwidth = Math.floor(Math.random() * 15) + 15;
            document.getElementById('bandwidthUsage').textContent = `${bandwidth}Mbps`;

            const connections = Math.floor(Math.random() * 100) + 200;
            document.getElementById('currentConnections').textContent = connections;

            const abnormalConn = isUnderAttack ? Math.floor(Math.random() * 10) + 5 : 0;
            document.getElementById('abnormalConnections').textContent = abnormalConn;
        }

        // ç”Ÿæˆæ”»å‡»æ—¥å¿—ï¼ˆé€‚é…æ‰‹æœºæ ·å¼ï¼‰
        function generateAttackLog(attackType, attackIp, isDefended = false) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN');
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `
                <span class="log-type ${isDefended ? 'defend' : 'attack'}">
                    ${isDefended ? 'é˜²å¾¡æˆåŠŸ' : 'æ”»å‡»å‘Šè­¦'}
                </span>
                <span class="log-content">${isDefended ? 'å·²æ‹¦æˆª' : 'æ£€æµ‹åˆ°'} ${attackType}ï¼ˆIPï¼š${attackIp}ï¼‰</span>
                <span class="log-time">${timeStr}</span>
            `;
            const logContainer = document.getElementById('attackLogContainer');
            logContainer.prepend(logItem);
            if (logContainer.children.length > 8) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // æ”»å‡»å€’è®¡æ—¶ï¼ˆæœªé˜²å¾¡æ—¶æ˜¾ç¤ºï¼‰
        function startAttackCountdown() {
            let remaining = ATTACK_DURATION / 1000;
            attackRemainingSeconds.textContent = remaining;
            attackCountdown.textContent = remaining;
            
            clearInterval(attackCountdownTimer);
            attackCountdownTimer = setInterval(() => {
                remaining--;
                attackRemainingSeconds.textContent = remaining;
                attackCountdown.textContent = remaining;
                if (remaining <= 0) {
                    clearInterval(attackCountdownTimer);
                    if (isUnderAttack) {
                        defendAttack(true); // è¶…æ—¶è‡ªåŠ¨é˜²å¾¡
                    }
                }
            }, 1000);
        }

        // é˜²å¾¡å€’è®¡æ—¶ï¼ˆé˜²å¾¡æ—¶æ˜¾ç¤ºï¼‰
        function startDefendCountdown() {
            let remaining = DEFEND_DURATION / 1000;
            defendCountdown.textContent = remaining;
            defendCountdownText.classList.add('show');
            
            clearInterval(defendCountdownTimer);
            defendCountdownTimer = setInterval(() => {
                remaining--;
                defendCountdown.textContent = remaining;
                if (remaining <= 0) {
                    clearInterval(defendCountdownTimer);
                    defendCountdownText.classList.remove('show');
                }
            }, 1000);
        }

        // æ¨¡æ‹Ÿæ”»å‡»äº‹ä»¶
        function simulateAttack() {
            if (isUnderAttack) return;

            isUnderAttack = true;
            attackCount++;

            const attackType = ATTACK_TYPE_POOL[Math.floor(Math.random() * ATTACK_TYPE_POOL.length)];
            const attackIp = ATTACK_IP_POOL[Math.floor(Math.random() * ATTACK_IP_POOL.length)];

            // æ›´æ–°å¼¹çª—å†…å®¹
            popupAttackType.textContent = attackType;
            popupAttackIp.textContent = attackIp;
            // æ˜¾ç¤ºå¼¹çª—ï¼ˆæœ€é«˜å±‚+ç™½è‰²èƒŒæ™¯ï¼‰
            attackPopup.classList.add('show');
            // å¯åŠ¨æ”»å‡»å€’è®¡æ—¶
            startAttackCountdown();

            // åŸæœ‰çŠ¶æ€æ›´æ–°
            document.getElementById('firewallCard').classList.add('under-attack');
            document.getElementById('firewallStatus').className = 'card-status status-danger';
            document.getElementById('firewallStatus').textContent = 'é­å—æ”»å‡»';
            document.getElementById('currentAttackStatus').textContent = `âš ï¸ ${attackType}`;
            document.getElementById('currentAttackStatus').className = 'data-value danger';
            document.getElementById('latestAttackIp').textContent = attackIp;
            document.getElementById('todayBlockCount').textContent = attackCount;
            document.getElementById('serverOverallStatus').className = 'card-status status-warning';
            document.getElementById('serverOverallStatus').textContent = 'æ”»å‡»ä¸­';
            panelDefendButton.classList.add('show');

            generateAttackLog(attackType, attackIp);

            // æ”»å‡»æŒç»­15ç§’ï¼Œè¶…æ—¶è‡ªåŠ¨é˜²å¾¡
            clearTimeout(attackTimer);
            attackTimer = setTimeout(() => {
                if (isUnderAttack) {
                    defendAttack(true); // è‡ªåŠ¨é˜²å¾¡æ ‡è®°
                }
            }, ATTACK_DURATION);
        }

        // é˜²å¾¡æ”»å‡»å‡½æ•°ï¼ˆå¸¦å€’è®¡æ—¶+è¿›åº¦æ¡ï¼‰
        function defendAttack(isAutoDefend = false) {
            if (!isUnderAttack) return;

            defendCount++;
            const attackIp = document.getElementById('latestAttackIp').textContent;
            const attackType = document.getElementById('currentAttackStatus').textContent.replace('âš ï¸ ', '');

            // 1. æ¸…é™¤æ”»å‡»å€’è®¡æ—¶
            clearInterval(attackCountdownTimer);

            // 2. å¯åŠ¨é˜²å¾¡åŠ¨æ€æ•ˆæœ
            startDefendAnimation();

            // 3. å¯åŠ¨é˜²å¾¡å€’è®¡æ—¶
            startDefendCountdown();

            // 4. æ¨¡æ‹Ÿé˜²å¾¡è¿›åº¦ï¼ˆ3ç§’å®Œæˆï¼‰
            let progress = 0;
            clearInterval(defendProgressTimer);
            popupDefendProgress.classList.add('show');
            defendProgressTimer = setInterval(() => {
                progress += (100 / (DEFEND_DURATION / 100));
                popupDefendProgressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(defendProgressTimer);
                    // 5. é˜²å¾¡å®Œæˆï¼Œæ›´æ–°çŠ¶æ€
                    finishDefend(attackType, attackIp, isAutoDefend);
                }
            }, 100);
        }

        // å¯åŠ¨é˜²å¾¡åŠ¨ç”»
        function startDefendAnimation() {
            // å¼¹çª—æŒ‰é’®åŠ¨ç”»
            popupDefendButton.textContent = 'ğŸ›¡ï¸ é˜²å¾¡ä¸­...';
            popupDefendButton.classList.add('defending');
            // é¢æ¿æŒ‰é’®åŠ¨ç”»
            panelDefendButton.textContent = 'ğŸ›¡ï¸ é˜²å¾¡ä¸­...';
            panelDefendButton.classList.add('defending');
            // ç¦æ­¢é‡å¤ç‚¹å‡»
            popupDefendButton.disabled = true;
            panelDefendButton.disabled = true;
        }

        // å®Œæˆé˜²å¾¡
        function finishDefend(attackType, attackIp, isAutoDefend) {
            // é‡ç½®é˜²å¾¡çŠ¶æ€
            popupDefendButton.textContent = 'ğŸ›¡ï¸ ç«‹å³é˜²å¾¡';
            popupDefendButton.classList.remove('defending');
            panelDefendButton.textContent = 'ğŸ›¡ï¸ ç«‹å³æ‰§è¡Œé˜²å¾¡æªæ–½';
            panelDefendButton.classList.remove('defending');
            popupDefendButton.disabled = false;
            panelDefendButton.disabled = false;
            popupDefendProgress.classList.remove('show');
            popupDefendProgressBar.style.width = '0%';

            // éšè—æ”»å‡»å¼¹çª—
            attackPopup.classList.remove('show');

            // åŸæœ‰çŠ¶æ€æ›´æ–°
            isUnderAttack = false;
            document.getElementById('firewallCard').classList.remove('under-attack');
            document.getElementById('firewallStatus').className = 'card-status status-normal';
            document.getElementById('firewallStatus').textContent = 'é˜²æŠ¤å¼€å¯';
            document.getElementById('currentAttackStatus').textContent = 'æ— æ”»å‡»é£é™©';
            document.getElementById('currentAttackStatus').className = 'data-value';
            document.getElementById('serverOverallStatus').className = 'card-status status-normal';
            document.getElementById('serverOverallStatus').textContent = 'è¿è¡Œæ­£å¸¸';
            panelDefendButton.classList.remove('show');

            // ç”Ÿæˆé˜²å¾¡æ—¥å¿—
            generateAttackLog(attackType, attackIp, true);

            // æ˜¾ç¤ºé˜²å¾¡æˆåŠŸæç¤º
            defendSuccessTip.classList.add('show');
            setTimeout(() => {
                defendSuccessTip.classList.remove('show');
            }, 2500);

            // æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
            clearTimeout(attackTimer);
            clearInterval(defendCountdownTimer);
            defendCountdownText.classList.remove('show');
        }

        // æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½ï¼ˆä¿æŒä¸å˜ï¼‰
        function manualRefreshData() {
            updateCurrentDateTime();
            document.getElementById('serverUptime').textContent = calculateServerUptime();
            simulateResourceUsage();

            const refreshBtn = document.getElementById('manualRefresh');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i>âœ…</i> å·²åˆ·æ–°';
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
            }, 1500);
        }

        // ç»‘å®šäº‹ä»¶
        popupDefendButton.addEventListener('click', () => defendAttack());
        panelDefendButton.addEventListener('click', () => defendAttack());
        document.getElementById('manualRefresh').addEventListener('click', manualRefreshData);

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            updateCurrentDateTime();
            document.getElementById('serverUptime').textContent = calculateServerUptime();
            document.getElementById('serverStartTime').textContent = SERVER_START_TIME.toLocaleString('zh-CN').replace(/\//g, '-').split(' ')[0] + ' ' + SERVER_START_TIME.toLocaleTimeString('zh-CN');
            document.getElementById('initialLogTime').textContent = updateCurrentDateTime().toLocaleTimeString('zh-CN');
            simulateResourceUsage();

            // æ•°æ®æ¯2ç§’åˆ·æ–°
            setInterval(() => {
                updateCurrentDateTime();
                document.getElementById('serverUptime').textContent = calculateServerUptime();
                simulateResourceUsage();
            }, 2000);

            // æ”»å‡»æ¯30ç§’è§¦å‘ä¸€æ¬¡
            setInterval(simulateAttack, ATTACK_INTERVAL);

            // åˆå§‹è§¦å‘ä¸€æ¬¡æ”»å‡»ï¼ˆå¯é€‰ï¼‰
            setTimeout(simulateAttack, 5000);
        }

        window.onload = init;
    </script>
</body>
</html>
